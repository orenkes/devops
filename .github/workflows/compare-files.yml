name: Compare files with variables and secrets

on:
  push:
  workflow_dispatch:

jobs:
  compare-with-variable:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Compare file with repo variable
        env:
          REPO_VAR: ${{ vars.MY_REPO_VAR }}
        run: |
          FILE_VALUE=$(cat data.txt)

          if [ "$FILE_VALUE" != "${{ vars.DATA }}" ]; then
            echo "FILE_VALUE: $FILE_VALUE"
            echo "DATA: ${{ vars.DATA }}"
            echo "‚ùå data.txt does not match repository variable"
            exit 1
          fi

          echo "‚úÖ data.txt matches repository variable"

  compare-with-secret:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Compare file with secret
        env:
          SECRET_VALUE: ${{ secrets.DATA }}
        run: |
          FILE_VALUE=$(cat data.txt)

          if [ "$FILE_VALUE" != "$SECRET_VALUE" ]; then
            echo "FILE_VALUE: $FILE_VALUE"
            echo "SECRET_VALUE: $SECRET_VALUE"
            echo "‚ùå data.txt does not match secret"
            exit 1
          fi

          echo "‚úÖ data.txt matches secret"

  success-job:
    runs-on: ubuntu-latest
    needs:
      - compare-with-variable
      - compare-with-secret

    steps:
      - uses: actions/checkout@v4

      - name: Confirm success (no secret printed)
        env:
          REPO_VAR: ${{ vars.MY_REPO_VAR }}
        run: |
          echo "üìÑ File value:"
          cat data.txt

          echo ""
          echo "üîß Repository variable value:"
          echo "$REPO_VAR"

          echo ""
          echo "‚úÖ All checks passed successfully"
