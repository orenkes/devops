name: Compare files with variables and secrets

on:
  push:
  workflow_dispatch:

jobs:
  compare-with-variable:
    name: Job 1 - Compare file with repo variable
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Compare file with repository variable
        env:
          REPO_VAR: ${{ vars.MY_REPO_VAR }}
        run: |
          FILE_VALUE=$(cat file_with_var.txt)

          if [ "$FILE_VALUE" != "$REPO_VAR" ]; then
            echo "‚ùå File value does not match repository variable"
            exit 1
          fi

          echo "‚úÖ File matches repository variable"

  compare-with-secret:
    name: Job 2 - Compare file with secret
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Compare file with secret
        env:
          SECRET_VALUE: ${{ secrets.MY_SECRET }}
        run: |
          FILE_VALUE=$(cat file_with_secret.txt)

          if [ "$FILE_VALUE" != "$SECRET_VALUE" ]; then
            echo "‚ùå File value does not match secret"
            exit 1
          fi

          echo "‚úÖ File matches secret"

  success-job:
    name: Job 3 - Run only if Job 1 and 2 succeed
    runs-on: ubuntu-latest
    needs:
      - compare-with-variable
      - compare-with-secret

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Print file and variable values (NO secret)
        env:
          REPO_VAR: ${{ vars.MY_REPO_VAR }}
        run: |
          echo "üìÑ File value:"
          cat file_with_var.txt

          echo ""
          echo "üîß Repository variable value:"
          echo "$REPO_VAR"

          echo ""
          echo "‚úÖ All checks passed successfully"
